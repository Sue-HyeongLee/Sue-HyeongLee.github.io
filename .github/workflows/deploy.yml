name: deploy

on: # íŠ¹ì • ì´ë²¤íŠ¸ ë°œìƒ
  push: # push í•˜ëŠ” ìƒí™©
    branches:
      - master
      - main
  pull_request: # pull_request í•˜ëŠ” ìƒí™©
    branches:
      - master
      - main
  workflow_dispatch: # ì‚¬ìš©ìê°€ ìˆ˜ë™ì ìœ¼ë¡œ workflowë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•  ë•Œ

permissions:
  contents: write # í•´ë‹¹ ì•¡ì…˜ì´ ë””ë ‰í† ë¦¬ì— ì“°ê¸° ê¶Œí•œì„ ê°€ì§ì„ ëª…í•¨.

jobs: # ì£¼ëœ ë‚´ìš©ë“¤
  deploy:
    # available images: https://github.com/actions/runner-images#available-images
    runs-on: ubuntu-latest # ìµœì‹  ìš°ë¶„íˆ¬ì—ì„œ ì´ê±¸ ì‹¤í–‰í•  ê²ƒì„.
    steps: # ì‹¤ì œë¡œ í•  ì¼ ë“¤
    - name: Checkout ğŸ›ï¸ # github ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ í˜„ì¬ ì‘ì—…í™˜ê²½ì— ì²´í¬ì•„ì›ƒ(ë³µì œ)í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
      uses: actions/checkout@v3 # actions/checkoutì˜ ì—­í• ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.
    - name: Setup Ruby 
      uses: ruby/setup-ruby@v1 # ì§€ì •ëœ ë²„ì „ì˜ ë£¨ë¹„ë¥¼ í™˜ê²½ì— ì„¤ì¹˜ í•´ì¤ë‹ˆë‹¤.
      with:
        ruby-version: '2.7.5'
        bundler-cache: true # bundler-cacheë¥¼ í™œì„±í™”í•´ì„œ ê°™ì€ ë²„ì „ì˜ ë£¨ë¹„ë¥¼ ë‹¤ì‹œ í™œì„±í™”í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
    - name: Update _config.yml âš™ï¸
      uses: fjogeleit/yaml-update-action@v0.13.1 # _config.yml íŒŒì¼ì„ ì—…ë°ì´íŠ¸ í•´ì¤ë‹ˆë‹¤.
      with:
        commitChange: false # ë³€ê²½ì‚¬í•­ì„ ì»¤ë°‹í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
        valueFile: '_config.yml' # updateí•  ê²½ë¡œë¥¼ ì…ë ¥.
        propertyPath: 'giscus.repo' # updateí•  ì†ì„±ì„ ì„¤ì •.
        value: ${{ github.repository }} # github.repositoryì˜ ì´ë¦„ìœ¼ë¡œ ê°’ì„ ë²ˆê²½.
    - name: Install and Build ğŸ”§
      run: | # í•„ìš”í•œ ê²ƒë“¤ì„ ì„¤ì¹˜í•˜ê³ , buildí•˜ëŠ” ì‘ì—…ë“¤ì„ í–‰í•©ë‹ˆë‹¤.
        pip3 install --upgrade jupyter 
        npm install -g mermaid.cli
        npm install -g purgecss
        export JEKYLL_ENV=production
        bundle exec jekyll build --lsi
        purgecss -c purgecss.config.js
    - name: Deploy ğŸš€
      if: github.event_name != 'pull_request' # pushì¼ ë•Œë§Œ ì‹¤í–‰ë  ê²ƒì„.
      uses: JamesIves/github-pages-deploy-action@v4 # github pageì— ìë™ìœ¼ë¡œ ë°°í¬í•˜ê¸° ìœ„í•œ ì™¸ë¶€ ì•¡ì…˜.
      with:
        folder: _site # site í´ë”ì— ìˆëŠ” ê²ƒì„ ë°°í¬í•  ê²ƒì„.

